{% extends "base.html" %}

{% block title %}Buscar Pel√≠culas - YTS Downloader{% endblock %}

{% block content %}
<h1>Buscar Pel√≠culas</h1>
        
<form method="GET" class="search-form">
    <input type="text" name="query" placeholder="Buscar pel√≠cula..." value="{{ query }}" required>
    <button type="submit" class="button">Buscar</button>
</form>

{% if results %}
<div class="search-results">
    {% for movie in results %}
    <div class="movie-card">
        <img src="{{ movie.medium_cover_image }}" alt="{{ movie.title }}" class="movie-poster">
        <div class="movie-info">
            <h3>{{ movie.title_long }}</h3>
            <div class="movie-details">
                <span class="movie-year">üìÖ {{ movie.year }}</span>
                <span class="movie-rating">‚≠ê {{ movie.rating }}/10</span>
                {% if movie.language %}
                <span class="movie-language">üó£ {{ movie.language }}</span>
                {% endif %}
            </div>
            <div class="movie-actions">
                <button class="button add-movie" 
                        onclick="addMovie({
                            title: '{{ movie.title_long }}',
                            year: '{{ movie.year }}',
                            rating: '{{ movie.rating }}',
                            magnet: '{{ build_magnet(movie)|safe }}',
                            subs: 'https://yifysubtitles.org/movie-imdb/{{ movie.imdb_code }}',
                            imdb_code: '{{ movie.imdb_code }}'
                        })">
                    Agregar y Descargar
                </button>
                <a href="https://www.imdb.com/title/{{ movie.imdb_code }}" 
                   target="_blank" 
                   class="button secondary-button">
                    Ver en IMDb
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% elif query %}
<div class="empty-state">
    <p class="no-results">No se encontraron resultados para "{{ query }}"</p>
    <p class="suggestion">Intenta con otro t√©rmino de b√∫squeda</p>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
async function addMovie(movieData) {
    try {
        const response = await fetch('/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(movieData)
        });
        
        const result = await response.json();
        
        if (response.ok) {
            alert(result.message);
            window.location.href = '/'; // Redirigir a la lista de pel√≠culas
        } else {
            alert(result.error || 'Error al agregar la pel√≠cula');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al comunicarse con el servidor');
    }
}
</script>
{% endblock %}
